/**
 * fusebar.js v0.2.8 - Private website search for browsers using Fuse.js as backend (https://www.thecshore.com/projects/fusebar)
 *
 * Copyright (c) 2020 Daniel F. Dickinson (https://www.thecshore.com)
 * All Rights Reserved. Apache Software License 2.0
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).fusebar={})}(this,(function(e){"use strict";var t={distance:1e3,findAllMatches:!0,shouldSort:!0,includeMatches:!0,minMatchCharLength:2,threshold:.3};function n(e){var n,r,a=new XMLHttpRequest;return a.open("GET",indexurl,!0),a.onload=function(){if(a.status>=200&&a.status<400){var s=!1,c=a.responseText.replace(/$/," "),o=JSON.parse(c),u=t;if(u.keys=[{name:"tags",weight:.99}],u.minMatchCharLength=Math.floor(.8*e.length),n=new Fuse(o,u),(r=n.search(e)).length>0&&(l(r,e,"Tags"),s=!0),u.keys=[{name:"categories",weight:.99}],n=new Fuse(o,u),(r=n.search(e)).length>0&&(l(r,e,"Categories"),s=!0),u.keys=[{name:"title",weight:.6},{name:"content",weight:.4}],u.distance=1e4,n=new Fuse(o,u),(r=n.search(e)).length>0&&(i(r,e,2),s=!0),!s){var d=document.createElement("p");d.innerHTML="No matches found",document.getElementById("search-results").appendChild(d)}}else console.log("fusebar had error "+a.status+" on "+indexurl)},a.onerror=function(){console.log("fusebar search connection error "+a.status)},a.send(),!1}function r(e){var t=document.createElement("mark"),n=document.createElement("span");return n.setAttribute("class","mark"),n.innerHTML=e,t.appendChild(n),t}function a(e){var t={};return e.forEach((function(e,n){var a=document.createElement("div"),i=0;e.indices.forEach((function(t,n){"content"==e.key&&e.value.length>1e3&&(e.value=e.value.substring(0,1e3));var l=e.value.substring(t[0],t[1]+1);if(t[0]>=i){var s=document.createElement("span");s.innerHTML=e.value.substring(i,t[0]),a.appendChild(s)}a.appendChild(r(l)),i=t[1]+1})),i<e.value.length&&a.appendChild(document.createTextNode(e.value.substring(i,e.value.length))),t[e.key]={element:a,original_value:e.value}})),t}function i(e,t,n){return e.forEach((function(e,t){var r=document.createElement("div");r.setAttribute("class","search-result"),r.id="search-result-"+(t+n).toString(),e.item.content&&e.item.content.length>1e3&&(e.item.content=e.item.content.substring(0,1e3));var i=a(e.matches);["Title","Content"].forEach((function(t){var n,a,l=t.toString().toLowerCase();if("title"==l&&((n=document.createElement("h4")).setAttribute("class","search-result-title"),(a=document.createElement("a")).setAttribute("href",e.item.permalink)),void 0!==i[l])if("title"==l)a.innerHTML=i[l].element.innerHTML,i[l].element.innerHTML&&""!=i[l].element.innerHTML||(a.innnerHTML="Untitled");else if("content"==l)(n=i.content.element).setAttribute("class","search-result-content");else{var s;(n=document.createElement("div")).setAttribute("class","search-result-"+l),n.appendChild(document.createTextNode(t+":  "));var c=!0;e.item[l].forEach((function(e,t){c?c=!1:n.appendChild(document.createTextNode(", ")),e==i[l].original_value?(s=document.createElement("span")).innerHTML=i[l].element.innerHTML:(s=document.createElement("span")).innerHTML=e,n.appendChild(s)}))}else"title"==l?(a.innerHTML=e.item.title,e.item.title&&""!=e.item.title||(a.innerHTML="Untitled")):"content"==l?e.item.content&&""!=e.item.content&&((n=document.createElement("div")).innerHTML=e.item.content):e.item[l]&&((n=document.createElement("div")).setAttribute("class","search-result-"+l),n.appendChild(document.createTextNode(t+":  ")),c=!0,e.item[l].forEach((function(e,t){c?c=!1:n.appendChild(document.createTextNode(", "));var r=document.createElement("span");r.innerHTML=e,n.appendChild(r)})));"title"==l&&n.appendChild(a),void 0!==n&&r.appendChild(n)})),document.getElementById("search-results").appendChild(r)})),!0}function l(e,t,n,r){var i=n.toString().toLowerCase(),l=document.createElement("div");l.setAttribute("class","search-result"),l.id="search-result-0";var s=document.createElement("div");s.setAttribute("class","search-result-"+i),s.innerHTML="<b>"+n+"</b>  (follow links for all matching pages): ";var c={},o=!0;return e.forEach((function(e,t){e.item.content&&e.item.content.length>1e3&&(e.item.content=e.item.content.substring(0,1e3));var n,r=a(e.matches);void 0!==r[i]&&e.matches.forEach((function(e){var t=null;e.value==r[i].original_value&&(c[e.value]||(o?o=!1:s.appendChild(document.createTextNode(", ")),c[e.value]=!0,(n=document.createElement("span")).innerHTML=r[i].element.innerHTML,(t=document.createElement("a")).setAttribute("href","/"+encodeURIComponent(i)+"/"+encodeURIComponent(e.value)+"/"),t.appendChild(n))),t&&s.appendChild(t)}))})),l.appendChild(s),document.getElementById("search-results").appendChild(l),!0}e.createMark=r,e.doCloseSearch=function(){document.getElementById("search-results")&&(document.getElementById("search-results").style="display: none; visibility: hidden;",document.getElementById("search-results").innerHTML="<h2>Search Results</h2>")},e.doSearch=function(){var e=document.search_form.s.value;if(e)document.getElementById("search-query")&&(document.getElementById("search-results").innerHTML="<h2>Search Results</h2>",document.getElementById("search-results").style="display: block; visibility: visible;",n(e));else{var t=document.createElement("p");t.innerText="Please enter a word or phrase above",document.getElementById("search-results")&&(document.getElementById("search-results").appendChild(t),document.getElementById("search-results").style="display: block; visibility: visible;")}return!1},e.executeSearch=n,e.markMatches=a,e.populateResults=i,Object.defineProperty(e,"__esModule",{value:!0})}));
